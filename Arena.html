<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BollyQuiz Arena v173.0 | Master Final</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700;900&family=Poppins:wght@400;500&family=Orbitron:wght@700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <style>
        :root { 
            --bg: #020617; --glass: rgba(15, 23, 42, 0.88); --dock-glass: rgba(15, 23, 42, 0.98); 
            --accent: #00d4ff; --gold: #fbbf24; --success: #10b981; --danger: #e11d48; --white: #f8fafc; 
        }
        * { box-sizing: border-box; margin: 0; padding: 0; scrollbar-width: none; }
        *::-webkit-scrollbar { display: none; }
        body { background: radial-gradient(circle at center, #1e293b 0%, var(--bg) 100%); color: var(--white); font-family: 'Poppins', sans-serif; height: 100vh; overflow: hidden; display: flex; flex-direction: column; transition: 0.4s; position: relative; }

        #setup-slide {
            background: linear-gradient(rgba(0,0,0,0.85), rgba(0,0,0,0.85)), url('https://images.unsplash.com/photo-1489599849927-2ee91cede3ba?auto=format&fit=crop&w=1920&q=80');
            background-size: cover; background-position: center; border-radius: 0 !important; width: 100% !important; height: 100vh !important; max-width: 100% !important;
        }
        .glitter-text { font-family: 'Cinzel'; font-weight: 900; background: linear-gradient(90deg, #ffd700, #ffffff, #ffea00, #c0c0c0, #ffd700); background-size: 300% 300%; -webkit-background-clip: text; -webkit-text-fill-color: transparent; animation: glitter 3s linear infinite; }
        @keyframes glitter { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        
        #bolt-btn { background: #ffcc00 !important; color: #000 !important; border-radius: 50% !important; width: 44px !important; height: 44px !important; display: flex !important; align-items: center !important; justify-content: center !important; box-shadow: 0 0 10px #ffcc00 !important; border: 2px solid #fff !important; transition: 0.3s; cursor: pointer; }
        .bolt-active { transform: scale(1.15); filter: brightness(1.2); animation: boltPulse 0.6s infinite alternate; }
        @keyframes boltPulse { from { box-shadow: 0 0 5px #ffcc00; } to { box-shadow: 0 0 25px #ffcc00; } }
        body.double-pts { border: 12px solid #ffcc00; box-shadow: inset 0 0 120px rgba(251, 191, 36, 0.5); }
        
        #stage { flex: 1; position: relative; display: flex; justify-content: center; align-items: center; padding: 15px; z-index: 10; min-height: 0; }
        .slide { position: absolute; width: 92%; max-width: 1100px; height: 62vh; background: var(--glass); border: 1px solid rgba(255,255,255,0.1); border-radius: 40px; padding: 30px; display: none; flex-direction: column; align-items: center; justify-content: center; backdrop-filter: blur(25px); text-align: center; box-shadow: 0 25px 60px rgba(0,0,0,0.8); overflow-y: auto; }
        .slide.active { display: flex; animation: slideUp 0.4s ease-out; }

        .theatre-hub { border-top: 5px solid rgba(0, 212, 255, 0.6); border-radius: 100% 100% 40px 40px / 12% 12% 0 0; box-shadow: 0 -30px 100px -20px var(--accent); padding-top: 50px !important; }
        .strategy-card { background: rgba(251, 191, 36, 0.1); border: 1px dashed var(--gold); border-radius: 20px; padding: 20px; margin-top: 20px; width: 80%; text-align: left; }

        #nav-dock { height: 70px; background: var(--dock-glass); border: 1px solid rgba(255,255,255,0.1); padding: 0 40px; border-radius: 100px; display: none; align-items: center; justify-content: center; gap: 20px; z-index: 9999; backdrop-filter: blur(15px); margin: 0 auto 15px auto; }
        #nav-dock button { font-size: 1.6rem; background: none; border: none; cursor: pointer; color: #fff; transition: 0.2s; }
        
        #scoreboard { height: 160px; background: rgba(1, 4, 9, 0.99); border-top: 1px solid rgba(255,255,255,0.1); display: none; grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)); gap: 10px; padding: 10px 30px; z-index: 10003; }
        .team-box { background: rgba(255,255,255,0.02); border-radius: 15px; padding: 5px; display: flex; flex-direction: column; align-items: center; border-bottom: 3px solid var(--accent); }
        .team-score-display { font-size: 1.6rem; font-weight: 900; font-family: 'Orbitron'; color: var(--gold); }
        .t-name-edit { background: transparent; border: none; color: #fff; font-weight: 600; text-align: center; width: 95%; font-size: 0.9rem; outline: none; }

        .btn-action { background: var(--accent); color: #000; border: none; padding: 12px 35px; font-weight: 900; cursor: pointer; border-radius: 12px; font-family: 'Cinzel'; transition: 0.3s; text-transform: uppercase; margin-top: 10px; }
        .q-text { font-size: 2.2rem; line-height: 1.2; color: #fff; font-family: 'Cinzel'; font-weight: 700; margin: 15px 0; }
        .ans-reveal { visibility: hidden; opacity: 0; transform: translateY(10px); transition: 0.4s; padding: 15px; border-radius: 15px; width: 85%; border: 2px solid var(--accent); background: rgba(0,212,255,0.1); font-size: 1.8rem; font-family: 'Cinzel'; font-weight: 900; color: var(--accent); }
        .ans-reveal.visible { visibility: visible; opacity: 1; transform: translateY(0); }
        .hint-box { opacity: 0; transition: 0.3s; color: var(--gold); font-weight: 600; background: rgba(251, 191, 36, 0.1); padding: 8px 20px; border-radius: 10px; margin-top: 10px; }
        .hint-box.visible { opacity: 1; }

        .rocket-anim { position: fixed; bottom: -150px; left: 50%; transform: translateX(-50%); z-index: 100000; pointer-events: none; white-space: nowrap; display: flex; flex-direction: column; align-items: center; animation: shootUpSlow 4.5s cubic-bezier(0.25, 0.1, 0.25, 1) forwards; }
        .rocket-team-text { font-family: 'Cinzel'; font-weight: 900; font-size: 3.5rem; background: linear-gradient(90deg, #ffd700, #ffffff, #ffea00, #ffd700); background-size: 300% 300%; -webkit-background-clip: text; -webkit-text-fill-color: transparent; animation: glitter 2s linear infinite; filter: drop-shadow(0 0 25px var(--gold)); }
        @keyframes shootUpSlow { 0% { bottom: -150px; opacity: 1; transform: translateX(-50%) scale(0.6); } 15% { bottom: 25%; transform: translateX(-50%) scale(1); } 85% { opacity: 1; } 100% { bottom: 110vh; opacity: 0; transform: translateX(-50%) scale(1.5); } }

        .confetti { position: fixed; width: 12px; height: 12px; z-index: 99999; pointer-events: none; border-radius: 2px; animation: fallConfetti 3.5s linear forwards; }
        @keyframes fallConfetti { to { transform: translateY(100vh) rotate(720deg); opacity: 0; } }

        #audit-ledger, #game-rules-page, #buzzer-modal, #url-settings { display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:rgba(2,6,23,0.98); width:85%; height:80%; z-index:60000; border-radius:30px; padding:40px; border:2px solid var(--accent); flex-direction:column; backdrop-filter: blur(40px); }
        
        @keyframes slideUp { from { opacity: 0; transform: translateY(40px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div id="fx-layer"></div>

<div id="stage">
    <div class="slide active" id="setup-slide">
        <h1 class="glitter-text" style="font-size:4rem; margin-bottom: 20px;">Bollywood & Hollywood Battle</h1>
        <div id="setup-container" style="display:grid; grid-template-columns:repeat(3, 1fr); gap:12px; width:100%; max-width:850px; margin: 40px 0; overflow-y: auto; max-height: 45vh; padding: 20px; background: rgba(0,0,0,0.3); border-radius: 20px;">
            <input type="text" class="t-in" value="Team 1" style="background:rgba(255,255,255,0.05); border:1px solid var(--accent); color:#fff; padding:12px; border-radius:8px; text-align:center;">
            <input type="text" class="t-in" value="Team 2" style="background:rgba(255,255,255,0.05); border:1px solid var(--accent); color:#fff; padding:12px; border-radius:8px; text-align:center;">
            <input type="text" class="t-in" value="Team 3" style="background:rgba(255,255,255,0.05); border:1px solid var(--accent); color:#fff; padding:12px; border-radius:8px; text-align:center;">
            <input type="text" class="t-in" value="Team 4" style="background:rgba(255,255,255,0.05); border:1px solid var(--accent); color:#fff; padding:12px; border-radius:8px; text-align:center;">
        </div>
        <button class="btn-action" style="font-size:1.8rem;" onclick="initGame()">ENTER ARENA</button>
    </div>
</div>

<div id="nav-dock">
    <button onclick="jumpTo('idx')" title="Hub"><i class="fas fa-home"></i></button>
    <button onclick="nav(-1)" title="Back"><i class="fas fa-chevron-left"></i></button>
    <button onclick="triggerHint()" title="Hint">ğŸ’¡</button>
    <div id="prog" style="color:var(--accent); font-family:Orbitron; font-weight:900; min-width:80px; text-align:center;"></div>
    <button onclick="triggerReveal()" title="Reveal">âœ¨</button>
    <button id="bolt-btn" onclick="toggleDouble()" title="High Stakes"><i class="fas fa-bolt"></i></button>
    <button onclick="nav(1)" title="Forward"><i class="fas fa-chevron-right"></i></button>
    <button onclick="toggleRules()" title="Game Rules">ğŸ“œ</button>
    <button onclick="toggleBuzzer()" title="Buzzer Lobby"><i class="fas fa-mobile-alt"></i></button>
    <button onclick="toggleAudit()" title="Ledger"><i class="fas fa-clipboard-list"></i></button>
</div>

<div id="buzzer-modal">
    <div style="display:flex; justify-content:space-between; align-items:center;">
        <h2 class="glitter-text">BUZZER LOBBY</h2>
        <button onclick="toggleBuzzer()" class="btn-action">CLOSE</button>
    </div>
    <div style="display:flex; gap:40px; align-items:center; justify-content:center; flex:1;">
        <div id="qr-container" style="background:white; padding:20px; border-radius:20px;">
            <img id="qr-img" style="width:250px; height:250px;">
        </div>
        <div style="text-align:left; max-width:400px;">
            <h3>Join on Mobile:</h3>
            <p>1. Scan the QR code.</p>
            <p>2. Select your team.</p>
            <p>3. Tap your phone to Buzz!</p>
            <button class="btn-action" style="margin-top:20px; background:var(--danger); color:white;" onclick="resetBuzzers()">RESET BUZZERS</button>
        </div>
    </div>
</div>

<div id="game-rules-page">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;"><h2 class="glitter-text">GAME RULES</h2><button onclick="toggleRules()" class="btn-action">CLOSE</button></div>
    <div class="rule-card"><h3>Standard Scoring</h3><p>â€¢ Correct Answer: <b>+10 Points</b><br>â€¢ Using a Hint: <b>-5 Points</b></p></div>
</div>

<div id="audit-ledger">
    <div style="display:flex; justify-content:space-between; align-items:center;"><h2 class="glitter-text">ARENA AUDIT</h2><button onclick="toggleAudit()" class="btn-action">CLOSE</button></div>
    <div id="audit-content" style="overflow-y:auto; flex-grow:1; margin-top:20px; font-family:monospace; color:#0f0;"></div>
</div>

<div id="scoreboard"></div>

<script>
// --- MASTER HARD-MAP LINK ---
const HARD_MAP_URL = "https://wakharkarsagar.github.io/bolly-quiz/";

const firebaseConfig = { apiKey: "AIzaSyDDAn3h5vQ71gd2gU2Dj1e9o0IwjHDdl-k", authDomain: "bollyquiz-arena.firebaseapp.com", databaseURL: "https://bollyquiz-arena-default-rtdb.firebaseio.com", projectId: "bollyquiz-arena", storageBucket: "bollyquiz-arena.firebasestorage.app", messagingSenderId: "847926254864", appId: "1:847926254864:web:221a8e4c82d1951add1995" };
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const shuffle = (a) => { for (let i = a.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [a[i], a[j]] = [a[j], a[i]]; } return a; };
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
function playBeep(f, d) { const o = audioCtx.createOscillator(); const g = audioCtx.createGain(); o.connect(g); g.connect(audioCtx.destination); o.frequency.value = f; g.gain.setValueAtTime(0.1, audioCtx.currentTime); o.start(); o.stop(audioCtx.currentTime + d); }

let cur = 0, teams = [], played = new Set(), isDouble = false, tRef = null;

const DATA = {
    rounds: [
        { id: 'r1', title: 'Emoji Movie Mania', timer: 15, brief: "Decode the Movie Title from the emojis.", questions: shuffle([
            {s:'ğŸ‡®ğŸ‡³', q:'ğŸ« ğŸ“’ ğŸ§ª ğŸ¼ ğŸš', h:'Release: 2009', ans:'3 Idiots'},
            {s:'ğŸ‡®ğŸ‡³', q:'ğŸ•¶ï¸ ğŸ¹ ğŸ§‘â€ğŸ¦¯ ğŸˆ ğŸ”ª', h:'Release: 2018', ans:'Andhadhun'},
            {s:'ğŸ‡®ğŸ‡³', q:'ğŸ° ğŸš¬ ğŸ©¸ â™ ï¸ ğŸ›¥ï¸', h:'Release: 2023', ans:'Animal'},
            {s:'ğŸ‡®ğŸ‡³', q:'ğŸ”‡ ğŸ‘‚ ğŸ“» ğŸš² ğŸ°', h:'Release: 2012', ans:'Barfi!'},
            {s:'ğŸ¬', q:'ğŸš¢ ğŸ§Š ğŸ» ğŸ’ ğŸšª', h:'Release: 1997', ans:'Titanic'}
        ])}
    ]
};

function logEvent(m) { const t = new Date().toLocaleTimeString(); document.getElementById('audit-content').innerHTML += `<div><span style="color:var(--accent)">[${t}]</span> ${m}</div>`; }

function spawnFX(teamName, type, val) {
    const layer = document.getElementById('fx-layer');
    const animBox = document.createElement('div');
    animBox.className = 'rocket-anim';
    animBox.innerHTML = `<span class="rocket-team-text">${teamName.toUpperCase()} ${val}</span>`;
    layer.appendChild(animBox);
    playBeep(880, 0.4);
    setTimeout(() => animBox.remove(), 4500);
}

function initGame() {
    const inputs = document.querySelectorAll('.t-in');
    teams = Array.from(inputs).filter(i => i.value.trim() !== "").map(i => ({ n: i.value, s: 0 }));
    if(teams.length === 0) return alert("Enter team names!");
    document.getElementById('setup-slide').style.display = 'none';
    
    // THE QR CODE FIX: USING HARD_MAP_URL
    document.getElementById('qr-img').src = `https://api.qrserver.com/v1/create-qr-code/?size=250x250&data=${encodeURIComponent(HARD_MAP_URL)}`;
    
    let html = `<div class="slide theatre-hub" id="idx"><h1 class="glitter-text" style="font-size:3.5rem;">THE SILVER SCREEN</h1><div id="dir" style="margin-top:20px; display:grid; grid-template-columns:repeat(3, 1fr); gap:12px; width:900px;"></div></div>`;
    DATA.rounds.forEach((r) => {
        html += `<div class="slide" id="${r.id}"><h1>ROUND: ${r.title}</h1><button class="btn-action" onclick="nav(1)">START</button></div>`;
        r.questions.forEach((q, i) => {
            html += `<div class="slide q-slide" data-timer="${r.timer}"><div class="q-text">${q.q}</div><div class="hint-box">${q.h}</div><div class="ans-reveal"><b>${q.ans}</b></div></div>`;
        });
    });
    document.getElementById('stage').innerHTML = html;
    document.getElementById('nav-dock').style.display = 'flex';
    document.getElementById('scoreboard').style.display = 'grid';
    updateScore(); updateDir(); show(0);
}

function show(n) { const slides = document.querySelectorAll('.slide'); slides.forEach(s => s.classList.remove('active')); cur = n; slides[cur].classList.add('active'); }
function updateScore() { document.getElementById('scoreboard').innerHTML = teams.map((t, i) => `<div class="team-box"><div class="t-name-edit">${t.n}</div><div class="team-score-display">${t.s}</div><button onclick="chS(${i},10)">+10</button></div>`).join(''); }
function chS(i, v) { teams[i].s += v; updateScore(); spawnFX(teams[i].n, 'plus', v); }
function updateDir() { document.getElementById('dir').innerHTML = DATA.rounds.map(r => `<button class="btn-action" onclick="jumpTo('${r.id}')">${r.title}</button>`).join(''); }
function triggerHint() { document.querySelector('.slide.active .hint-box').classList.toggle('visible'); }
function triggerReveal() { document.querySelector('.slide.active .ans-reveal').classList.toggle('visible'); }
function nav(d) { show(cur+d); }
function jumpTo(id) { const slides = Array.from(document.querySelectorAll('.slide')); show(slides.indexOf(document.getElementById(id))); }
function toggleAudit() { document.getElementById('audit-ledger').style.display = 'flex'; }
function toggleRules() { document.getElementById('game-rules-page').style.display = 'flex'; }
function toggleBuzzer() { document.getElementById('buzzer-modal').style.display = 'flex'; }
function resetBuzzers() { db.ref('arena/buzz').set(null); }

// THE LISTENER FOR THE MOBILE BUZZER
db.ref('arena/buzz').on('value', snap => {
    const b = snap.val();
    if(b) {
        spawnFX(b.teamName, 'plus', "BUZZED!");
        setTimeout(() => db.ref('arena/buzz').set(null), 3000);
    }
});
</script>
</body>
</html>
